name: Update DevCycle SDK to Latest
on:
  pull_request:
  # schedule:
  #   - cron: "14 14 * * *"
  workflow_dispatch:

jobs:
  update-dvc:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v3
        with:
          node-version: '20.x'
          cache: 'yarn'

      - name: Set Git author
        shell: bash
        run: |
          git config --global user.email "github-tracker-bot@taplytics.com"
          git config --global user.name "DevCycle Automation"

      - name: Set branch name
        shell: bash
        run: echo "BRANCH_NAME=update-dvc-sdk" >> $GITHUB_ENV

      - name: Update @devcycle/react-client-sdk to latest
        run: |
          git checkout -b "$BRANCH_NAME"
          yarn add @devcycle/react-client-sdk@latest
          git add package.json
          git add yarn.lock
          git commit -m "Update @devcycle/react-client-sdk to latest"

      - name: Push changes
        shell: bash
        run: git push --set-upstream origin "$BRANCH_NAME"

      - name: Create Pull Request
        shell: bash
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh pr create \
          --base main --head "$BRANCH_NAME" \
          --title "chore(deps): Update @devcycle/react-client-sdk to latest" \
          --body "This PR is auto generated by [github workflow](https://github.com/${{ github.repository }}/actions?query=workflow%3A${{ github.workflow }})."

      # - name: Create Pull Request
      #   uses: peter-evans/create-pull-request@v3
      #   with:
      #     token: ${{ secrets.GITHUB_TOKEN }}
      #     title: "chore(deps): Update @devcycle/react-client-sdk to latest"
      #     commit-message: "chore(deps): Update @devcycle/react-client-sdk to latest"
      #     body: |
      #       This PR is auto generated by [github workflow](https://github.com/${{ github.repository }}/actions?query=workflow%3A${{ github.workflow }}).
      #     branch: update-dvc-sdk